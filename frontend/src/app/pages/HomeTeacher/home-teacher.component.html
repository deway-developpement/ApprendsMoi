<app-header theme="light"></app-header>

<div class="dashboard-wrapper">
  <div class="dashboard-header-bg">
    <div class="header-content">
      <div class="teacher-header">
        <h3 class="welcome-title">Bonjour {{ teacherName }}</h3>

        <app-icon
          *ngIf="verificationStatus === 3"
          [icon]="'assets/icons/verified-user.svg'"
          [size]="25"
          class="verified-icon"
          title="Profil verifie"
          [invertColor]="true">
        </app-icon>
      </div>

      <p class="welcome-subtitle" *ngIf="isVerified">
        Voici le resume de votre activite pour ce mois.
      </p>
      <p class="welcome-subtitle warning" *ngIf="!isVerified">
        Votre compte n'est pas encore verifie. Veuillez soumettre vos documents d'identite.
      </p>
    </div>
  </div>

  <main class="dashboard-container">
    <div *ngIf="!isVerified" class="verification-warning">
      <h3>Acces limite</h3>
      <p>Votre compte enseignant n'est pas encore verifie. Pour acceder a toutes les fonctionnalites :</p>
      <ol>
        <li>Soumettez votre piece d'identite (obligatoire)</li>
        <li>Ajoutez vos diplomes (optionnel mais recommande)</li>
        <li>Attendez la validation par notre equipe</li>
      </ol>
      <a class="verification-link" routerLink="/documents">
        Acceder a la gestion des documents
      </a>
    </div>

    <section class="widgets-section" *ngIf="isVerified">
      <div class="widgets-grid four-columns">
        <div class="widget-card accent-blue">
          <div class="widget-top">
            <div class="icon-circle blue">
              <app-small-icon icon="/assets/icons/star-fill.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Note moyenne</h3>
          </div>
          <div class="widget-content">
            <p class="metric-value">{{ averageRatingLabel }}<span *ngIf="averageRatingLabel !== '-'"> / 5</span></p>
            <p class="metric-inline">{{ numberOfReviewersLabel }} avis</p>
            <p class="subtext" *ngIf="teacherStats.numberOfReviewers > 0; else noRatingYet">Nombre d'avis recus</p>
            <ng-template #noRatingYet>
              <p class="subtext">Aucun avis pour le moment</p>
            </ng-template>
          </div>
        </div>

        <div class="widget-card accent-orange">
          <div class="widget-top">
            <div class="icon-circle orange">
              <app-small-icon icon="/assets/icons/notification.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Notifications ({{ pendingRequests.length }})</h3>
          </div>
          <div class="widget-content" *ngIf="pendingRequests.length > 0; else noNotifications">
            <p class="metric-value">{{ pendingRequests.length }}</p>
            <p class="subtext"><strong>{{ pendingRequests[0].parentName }}</strong></p>
            <p class="subtext">{{ pendingRequests[0].subject }} - {{ pendingRequests[0].date | date:'dd/MM HH:mm' }}</p>
            <div class="widget-action-row">
              <app-button variant="primary" size="small" (click)="acceptRequest(pendingRequests[0])">Accepter</app-button>
              <app-button variant="ghost" size="small" (click)="rejectRequest(pendingRequests[0])">Refuser</app-button>
            </div>
          </div>
          <ng-template #noNotifications>
            <div class="widget-content">
              <p class="metric-value">0</p>
              <p class="subtext">Aucune notification en attente</p>
            </div>
          </ng-template>
        </div>

        <div class="widget-card accent-green">
          <div class="widget-top">
            <div class="icon-circle green">
              <app-small-icon icon="/assets/icons/account-balance.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Revenus du mois</h3>
          </div>
          <div class="widget-content">
            <p class="metric-value">{{ earningsThisMonthLabel }}</p>
            <p class="subtext">Total cumule sur le mois en cours</p>
          </div>
        </div>

        <div class="widget-card accent-purple">
          <div class="widget-top">
            <div class="icon-circle purple">
              <app-small-icon icon="/assets/icons/people.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Eleves suivis</h3>
          </div>
          <div class="widget-content">
            <p class="metric-value">{{ currentStudentsFollowingLabel }}</p>
            <p class="subtext">Eleves actuellement suivis</p>
          </div>
        </div>
      </div>
    </section>

    <div *ngIf="isVerified" class="card-header-actions">
      <a class="see-more-btn" routerLink="/teacher/planning">
        Mettre a jour mes disponibilites
      </a>
    </div>

    <app-courses-schedule
      *ngIf="isVerified"
      [courses]="courses"
      (action)="openVisio($event)">
    </app-courses-schedule>

    <app-teacher-reviews
      *ngIf="isVerified && currentUserId"
      [teacherId]="currentUserId!">
    </app-teacher-reviews>

    <div *ngIf="!currentUserId && isVerified" class="loading-placeholder">
      <p>Chargement des avis...</p>
    </div>

    <section *ngIf="isVerified" class="documents-section">
      <div class="section-header">
        <h3>Mes documents de verification</h3>
      </div>
      <div class="section-content">
        <p class="section-description">
          Gerez vos documents d'identite et diplomes pour la verification de votre compte.
        </p>
        <a class="action-link" routerLink="/documents">
          Acceder a mes documents
        </a>
      </div>
    </section>
  </main>
</div>
