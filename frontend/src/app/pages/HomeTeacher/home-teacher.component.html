<app-header theme="light"></app-header>

<div class="dashboard-wrapper">
  
  <div class="dashboard-header-bg">
    <div class="header-content">
      <h1 class="welcome-title">Bonjour {{ teacherName }} üëã</h1>
      <p class="welcome-subtitle" *ngIf="isVerified">Voici le r√©sum√© de votre activit√© pour ce mois.</p>
      <p class="welcome-subtitle warning" *ngIf="!isVerified">‚ö†Ô∏è Votre compte n'est pas encore v√©rifi√©. Veuillez soumettre vos documents d'identit√©.</p>
    </div>
  </div>

  <main class="dashboard-container">
    
    <!-- Verification Warning for Unverified Teachers -->
    <div *ngIf="!isVerified" class="verification-warning">
      <h3>üîí Acc√®s limit√©</h3>
      <p>Votre compte enseignant n'est pas encore v√©rifi√©. Pour acc√©der √† toutes les fonctionnalit√©s :</p>
      <ol>
        <li>Soumettez votre pi√®ce d'identit√© (obligatoire)</li>
        <li>Ajoutez vos dipl√¥mes (optionnel mais recommand√©)</li>
        <li>Attendez la validation par notre √©quipe</li>
      </ol>
      <a class="verification-link" routerLink="/documents">
        üìÑ Acc√©der √† la gestion des documents ‚Üí
      </a>
    </div>

    <section class="widgets-section" *ngIf="isVerified">
      <div class="widgets-grid three-columns"> <div class="widget-card accent-blue">
          <div class="widget-top">
            <div class="icon-circle blue">
              <app-small-icon icon="/assets/icons/schedule.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Prochain cours</h3>
          </div>
          <div class="widget-content" *ngIf="nextCourse; else noCourse">
            <div class="main-info">
              <span class="big-date">{{ nextCourse.date | date:'dd MMM' }}</span>
              <span class="time">{{ nextCourse.date | date:'HH:mm' }}</span>
            </div>
            <p class="subtext">Avec {{ nextCourse.childName }} ({{ nextCourse.mode }})</p>
            <div class="widget-action">
              <app-button variant="ghost">Voir le d√©tail</app-button>
            </div>
          </div>
          <ng-template #noCourse>
            <p class="empty-state">Aucun cours pr√©vu aujourd'hui.</p>
          </ng-template>
        </div>

        <div class="widget-card accent-orange">
          <div class="widget-top">
            <div class="icon-circle orange">
               <app-small-icon icon="/assets/icons/notification.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Demandes ({{ pendingRequests.length }})</h3>
          </div>
          
          <div class="widget-content" *ngIf="pendingRequests.length > 0; else noRequests">
            <div class="request-item">
              <p class="request-title"><strong>{{ pendingRequests[0].parentName }}</strong></p>
              <p class="subtext">{{ pendingRequests[0].subject }} ‚Ä¢ {{ pendingRequests[0].date | date:'dd/MM HH:mm' }}</p>
            </div>
            <div class="widget-action-row">
              <app-button variant="primary" class="small-btn">Accepter</app-button>
              <app-button variant="ghost" class="small-btn">Refuser</app-button>
            </div>
          </div>
          <ng-template #noRequests>
            <div class="widget-content">
                <p class="empty-state">Vous √™tes √† jour !</p>
                <p class="subtext">Aucune nouvelle demande.</p>
            </div>
          </ng-template>
        </div>

        <div class="widget-card accent-green">
          <div class="widget-top">
            <div class="icon-circle green">
               <app-small-icon icon="/assets/icons/account-balance.svg" [size]="30"></app-small-icon>
            </div>
            <h3>Revenus (Oct.)</h3>
          </div>
    <div class="card-header-actions" *ngIf="isVerified">>
            <div class="main-info">
              <span class="big-amount">{{ currentMonthRevenue }} ‚Ç¨</span>
            </div>
            <p class="subtext">+{{ pendingRevenue }} ‚Ç¨ en attente</p>
            <div class="widget-action">
              <app-button variant="ghost">Voir mes paiements</app-button>
            </div>
          </div>
        </div>

      </div>
    </section>

    <div class="card-header-actions">
      <a class="see-more-btn" routerLink="/teacher/planning">
        Mettre √† jour mes disponibilit√©s 
      </a>
    </div>

    <app-courses-schedule
      *ngIf="isVerified"
      [courses]="courses"
      (action)="openVisio($event)">
    </app-courses-schedule>

    <app-teacher-reviews 
      *ngIf="isVerified && currentUserId" 
      [teacherId]="currentUserId!">
    </app-teacher-reviews>

    <div *ngIf="!currentUserId && isVerified" class="loading-placeholder">
        <p>Chargement des avis...</p>
    </div>

    <section class="documents-section">
      <div class="section-header">
        <h3>üìÑ Mes documents de v√©rification</h3>
      </div>
      <div class="section-content">
        <p class="section-description">G√©rez vos documents d'identit√© et dipl√¥mes pour la v√©rification de votre compte.</p>
        <a class="action-link" routerLink="/documents">
          Acc√©der √† mes documents ‚Üí
        </a>
      </div>
    </section>

  </main>
</div>
